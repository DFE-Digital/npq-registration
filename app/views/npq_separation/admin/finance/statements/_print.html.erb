<% content_for :head do %>
  <%= nonced_stylesheet_link_tag "print" %>
<% end %>

<div class="print-notice">
  <p class="govuk-body govuk-!-margin-bottom-0">
    This is a print-friendly version of the statement. You can close this page when you have finished saving/printing.
    <%= govuk_button_link_to "Close", "#", onclick: "window.close(); return false;", secondary: true, class: "align-baseline govuk-!-margin-left-5" %>
  </p>
</div>

<h1 class="govuk-heading-l"><%= @statement.lead_provider.name %> , <%= statement_name(@statement) %></h1>

<%= govuk_inset_text(text: "Calculations may have minor rounding discrepancies. Contact your contract manager for clarification.") %>

<%=
  govuk_summary_list(card: { title: "Overview" }) do |sl|
    sl.with_row do |row|
      row.with_key(text: "Cohort")
      row.with_value(text: internal_dfe_use ? @statement.cohort.name : @statement.cohort.start_year)
    end

    if internal_dfe_use
      sl.with_row do |row|
        row.with_key(text: "Cohort description")
        row.with_value(text: @statement.cohort.description)
      end
    end

    sl.with_row do |row|
      row.with_key(text: "Output payment date")
      row.with_value(text: @statement.payment_date.to_fs(:govuk))
    end

    sl.with_row do |row|
      row.with_key(text: "Status")
      row.with_value(text: @statement.state.humanize)
    end

    sl.with_row do |row|
      row.with_key(text: "Statement ID")
      row.with_value(text: @statement.ecf_id)
    end

    if internal_dfe_use
      sl.with_row do |row|
        row.with_key(text: "Payment run")
        row.with_value(text: boolean_red_green_tag(@statement.output_fee))
      end

      if @statement.marked_as_paid_with_date?
        sl.with_row do |row|
          row.with_key(text: "Payment status")
          row.with_value(text: "Authorised for payment at #{@statement.marked_as_paid_at.in_time_zone("London").strftime("%-I:%M%P on %-e %b %Y")}")
        end
      end
    end
  end
%>

<%= render NpqSeparation::Admin::StatementSummaryComponent.new(statement: @statement) %>

<div class="avoid-page-break">
  <h1 class="govuk-heading-l govuk-!-margin-bottom-5">Manual adjustments</h1>
  <h2 class="govuk-heading-m">Additional adjustments</h2>

  <%= render NpqSeparation::Admin::AdjustmentsTableComponent.new(adjustments: @statement.adjustments, show_total: true) %>
</div>

<h1 class="govuk-heading-l govuk-!-margin-bottom-5 avoid-page-break-after">Course finance details</h1>

<% @contracts.each do |contract| %>
  <div class="avoid-page-break">
    <h2 class="govuk-heading-m"><%= contract.course.name %></h2>
    <%= render NpqSeparation::Admin::CoursePaymentOverviewComponent.new(contract:) %>
  </div>
<% end %>

<% if @special_contracts.any? %>
  <div class="avoid-page-break">
    <h4 id="standalone_payments" class="govuk-heading-l govuk-!-margin-top-9 govuk-!-margin-bottom-7">Standalone payments</h4>
    <% @special_contracts.each do |contract| %>
      <%= render NpqSeparation::Admin::CoursePaymentOverviewComponent.new(contract:) %>
    <% end %>
  </div>
<% end %>

<div class="avoid-page-break">
  <h2 class="govuk-heading-m">Contract Information</h2>
  <%= render partial: "contract_information", locals: { start_open: true } %>
</div>
