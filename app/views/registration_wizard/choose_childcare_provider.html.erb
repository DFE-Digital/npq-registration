<% content_for :title do %>
  <%= @form.errors.present? ? "Error: " : nil %>Choose your nursery
<% end %>

<% content_for :before_content do %>
  <%= render GovukComponent::BackLinkComponent.new(
    text: "Back",
    href: registration_wizard_show_path(@wizard.previous_step_path)
  ) %>
<% end %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <%= form_with model: @form, url: registration_wizard_form_url(@form), scope: 'registration_wizard', method: :patch do |f| %>
      <%= f.govuk_error_summary %>

      <h1 class="govuk-heading-xl">Choose your nursery</h1>

      <% if @form.display_childcare_providers? %>
        <% if @form.possible_institutions.blank? %>
          <p class="govuk-body">Choose from nurseries located in <strong><%= @form.wizard.store["institution_location"] %></strong></p>

          <p class="govuk-body">No nurseries were found with that name, please try again</p>

          <%= f.govuk_text_field :institution_name,
                                 width: "full",
                                 label: { text: "Enter name" } %>
        <% else %>
          <%= f.govuk_radio_buttons_fieldset(:institution_identifier, legend: { size: 'm', text: "Please choose from nurseries located in #{@form.wizard.store["institution_location"]}" }) do %>
            <% @form.possible_institutions.each do |institution| %>
              <%= f.govuk_radio_button :institution_identifier, institution.identifier, label: { text: institution.name }, hint: { text: institution.address_string }, link_errors: true %>
            <% end %>
            <%= f.govuk_radio_divider %>
            <%= f.govuk_radio_button :institution_identifier, 'other', label: { text: "Nursery not shown above" } do %>
              <%= f.govuk_text_field :institution_name, label: { text: "Search for another nursery name" } %>
            <% end %>
          <% end %>
        <% end %>
      <% else %>
        <p class="govuk-body">Choose from nurseries located in <%= @form.wizard.store["institution_location"] %></p>
        <div class="npq-js-hidden">
          <%= f.govuk_text_field :institution_name,
                                 width: "full",
                                 label: { text: "Enter name", class: "govuk-label govuk-label--s" } %>
        </div>

        <div class="npq-js-reveal">
          <div class="govuk-form-group">
            <%= f.label :institution_identifier, "Enter name", class: "govuk-label govuk-label--s", for: "nursery-picker" %>
            <%= f.text_field :institution_identifier, data: { location: @form.wizard.store["institution_location"] }, id: "nursery-picker" %>
          </div>
        </div>
      <% end %>

      <%= f.govuk_submit %>
    <% end %>
  </div>
</div>
