<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <%= render "admin/layout", title: "Closed registration users" %>

    <h2 class="govuk-heading-l">Add new email</h2>
    <%= form_for [:admin, @user] do |f| %>
      <%= f.govuk_error_summary %>
      <%= f.govuk_text_field :email,  legend: { text: 'Provide course start date' } %>
      <%= f.govuk_submit "Save" %>
    <% end %>

    <h2 class="govuk-heading-l">Currently allowed emails</h2>

    <table class="govuk-table">
      <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th scope="col" class="govuk-table__header">User</th>
        <th scope="col" class="govuk-table__header">Has account</th>
        <th scope="col" class="govuk-table__header">Last application date</th>
      </tr>
      </thead>

      <tbody class="govuk-table__body">
      <% @users.each do |user| %>
        <tr class="govuk-table__row">
          <td class="govuk-table__cell"><%= user.email %></td>
          <td class="govuk-table__cell">
            <% service_user = User.find_by(email: user.email) %>
            <% if service_user.present? %>
              <strong class="govuk-tag govuk-tag--green">
                Yes
              </strong>
            <% else %>
              <strong class="govuk-tag govuk-tag--red">
                No
              </strong>
            <% end %>
          </td>
          <td class="govuk-table__cell">
            <% if service_user.present? %>
              <%= service_user.applications.order("created_at DESC").first.try(:created_at) %>
            <% end %>
          </td>
        </tr>
      <% end %>
      </tbody>
    </table>

  </div>
</div>
